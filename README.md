# Current Kali configuration

It is interesting to see how a pentester configures their own Kali OS, shells, terminals, shortcuts, and each one of their applications. Every single detail improves your work. 

Here are my key OS and tool configurations that help reduce spending my time on enumerations and attacks, being as productive and efficient as possible. 

- Kali
- Tmux
- Fish, plus bash/zsh 

## My Kali environment at login

      uname -a	
      Linux kali 5.14.0-kali4-amd64 #1 SMP Debian 5.14.16-1kali1 (2021-11-05) x86_64 GNU/Linux  

      lsb_release -a
      No LSB modules are available.
      Distributor ID: Kali
      Description:    Kali GNU/Linux Rolling
      Release:        2021.4
      Codename:       kali-rolling

      echo $SHELL
      /bin/bash
I still use the bash as my primary shell to keep my working configurations maintained. In the future, I may shift to zsh but... . 

## Tmux screen 

Currently, my tmux screen is based on fish shell with tide UI configured. 
![](https://github.com/kiwatana/PentestEnvironment/blob/main/tmux.jpg)

## Shell Environment for Pentest 
I switch to fish shell. The fish-tmux combination makes my life easy, especially with super-fast command selection capabilities including syntax highlighting, autosuggestion and autocomplication out of the box. It also can integrate pico 

     sudo apt install fish 

Other important setups include: 
1.   Plug in Manager - Fisher https://github.com/jorgebucaran/fisher
2.   Font - Hack              https://github.com/jorgebucaran/fisher
3.   Terminal UI - tide       https://github.com/IlanCosman/tide  
4.   Jump around - z          https://github.com/jethrokuan/z/blob/master/man/man1/z.md
5.   Peco                     https://github.com/peco/peco
![](https://github.com/kiwatana/PentestEnvironment/blob/main/peco.gif)

I am tired of typing a long line of commands and commands, checking your notes, syntacks, and man pages,etc. I use a fish autosuggestion and completion to select my best option from history and command options available in the terminal. 

## Environment Variables 

I also utlizes S1REN's practice on maintaining envionrment variables within a list of attack/enumeration commands. https://www.youtube.com/watch?v=RjvPc8OmjSE&t=2517s 

I set environment variables such as URL, LHOST, RHOST, PRROJECT, and SCREENSHOT.  Thses are not global environments, but local environment for a tmux session. I will use one tmux session for a single box. If I need to tackle another box, I will open another terminal and run tmux.   

When you run tmux, a command like below whould be your friend.

     tmux new -s 10.x.x.x -e RHOST=10.x.x.x -e LHOST=192.168.x.x -e PROJECT=/home/ xxxxxx/xxxxx/lab/YourProject

The environment variables wil be kept in the curent tmux sessions. As long as you keep the session, the variables are only effective in the session. 

Once you set up environment variables, you run attack commands like

     nmap -sC -sV -o nmap/init $RHOST

This nmap command is never modified in tmux terminal and in my attack library. Only my enviornment variables will be updated for another machine in a different tmux session. Use a fish autosuggestion, hit your tab & return keys to run. 

# tmux configuration

Currently I have two small improvements over normal tmux configurations. Small improvements lead to big productivity difference. 

## Copy & paste without exiting copy-mode

Currently, my tmux config defines the following key binds:
  
	• Prefix and C+u -> Remain copy mode but enable to copy and paste
	• Prefix and C+y -> Exit copy mode and enable to copy and paste (tmux-yank plugin is enabled) 

Here is the actual configuration in .tmux.conf: 

     bind -n C-y source-file ~/.tmux.conf \; display-message "Reload exit-copy-mode while copying!!"     
     bind -n C-u run-shell "~/.tmux_copy.sh" \; display-message "Load remain-copy-mode while copying!!"  

An external shell - .tmux_copy.sh is executed to remain copy mode. The shell has the following codes. 

     tmux set-option mouse on
     tmux bind-key -Tcopy-mode-vi MouseDragEnd1Pane send-key -X copy-pipe "xsel -i -b"
     tmux bind-key -Tcopy-mode-vi Y send -X copy-pipe "xsel -i -b"

xsel works for system clipboard setting in my Kali environment.

![](https://github.com/kiwatana/PentestEnvironment/blob/main/tmux_copy.gif)


## Left status bar for my IP address, VPN addresses, and target machine's address

I currently set the eth0, tun0, and tun1 addresses, and the target machine IP address on the left status bar in the tmux. It is nice to see the IP addresses when you set a reverse shell. 

    set -g status-left-length 100
    set -g status-left-style default
    set -g status-left "#h #( $HOME/.tmux/left_status.sh )"

also check left_status.sh script that shows these ipaddresses.

![](https://github.com/kiwatana/PentestEnvironment/blob/main/tmux_left_status_bar.png)


# Screenshot 

Screenshot is an interesting challenge when doing your pentesting. A effective screenshot will increase your credibility on reporting and often it is a requirement. Howerver, when attacking boxes in a limited-time environment, it is quite normal that you forgot taking screenshots and needs to come back to previous steps for screenshot. 

I am preparing two different ways of taking screenshots. 

1) Mannual screenshot when needed 
2) Automatic screenshot for every single command. 


## Mannual screenshot  

As usual, set up application shortcuts for region to select and for full screen. Currently, I set up the following configuration on Kali. 

Go to Settings->Keyborad->Application Shortcut

     'flameshot flameshot full -c -p  PathtoDirectory' Ctr+Backslash
     'flameshot gui' Ctr+]

Most of time, use flameshot gui to sellect the region, copy it to clipboard, and then paste it to OneNote or your note. 

## Auto screenshot  

The following fish config will invoke commands after every single command in .config/fish/config.bash.  

     function my_postexec --on-event fish_postexec
          echo ""
          echo "command completed: $argv[1] ($status)"
          if set -q SCREENSHOT
               if set -q PROJECT
                    flameshot screen -p $PROJECT/screenshots/
               else
                    flameshot screen -p $HOME/Pictures/
               end
          end
     end

You will need to set up a SCREENSHOT environment variable to control this execution. 

### Five different ways of enabling and disabling screenshots
<p>
<p>
<i>This may cause some negative impacts when a process is already being run such as bruteforce or revere sehll. Please ensure you test them and evaluate the risk you are making before taking this approach. </i>

There are 5 different ways to control this automatic screenshot. 

1) Add the environment to tmux command when launching it
2) Run a command for a current pane
3) Run a command for all panes in current window in current session 
4) Run a command for all panes in all windows in current session
5) Run a command for all panes in all windows in all sessions 


### 1) Add the environment to tmux command when launching it

     tmux new -s 10.x.x.x -e RHOST=10.x.x.x -e LHOST=192.168.x.x -e PROJECT=/home/ xxxxxx/xxxxx/lab/YourProject -e SCREENSHOT=YES

### 2) Run a command for a current pane

Run the commands in your terminal in current pane:  

     set SCREENSHOT YES  # Enable screenshot  or
     set -e SCREENSHOT   # Disable screenshot

### 3) Run a command for all panes in current window in current session 

Type tmux keybinding and run commands in terminal: 

     Prefix Alt+[  #synchorize-panes on 
     set SCREENSHOT YES  # Enable screenshot  or 
     set -e SCREENSHOT   # Disable screenshot
     Prefix Alt+[  #synchorize-panes off  

Check .tmux.config for keybinding configuration. 

### 4) Run a command for all panes in all windows in current session 

Type tmux keybinding and run a command in terminal: 

     Prefix Alt+]  #Open a command prompt in tmux  
     set SCREENSHOT YES  # Enable screenshot  or 
     set -e SCREENSHOT   # Disable screenshot

Check .tmux.config for keybinding configuration. 

### 5) Run a command for all panes in all windows in all sessions 

Type tmux keybinding and run a command in terminal: 

     Prefix Alt+/  #Open command prompt in tmux  
     set SCREENSHOT YES  # Enable screenshot  or 
     set -e SCREENSHOT   # Disable screenshot

Check .tmux.config for keybinding configuration. 



